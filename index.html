<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Book Recommendations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
            padding: 20px 0;
            transition: background 0.5s ease;
        }

        .background-circles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        #hypnoticCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .quiz-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
            position: relative;
            z-index: 10;
            margin: 20px auto;
            max-height: none;
        }

        .quiz-header {
            margin-bottom: 30px;
        }

        .quiz-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .quiz-subtitle {
            font-size: 16px;
            color: #666;
            line-height: 1.5;
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question {
            font-size: 20px;
            color: #444;
            margin-bottom: 25px;
            line-height: 1.4;
            font-weight: 500;
        }

        .question-number {
            color: #007bff;
            font-weight: 600;
        }

        .options {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .option-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
            min-width: 120px;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        .option-btn:active {
            transform: translateY(0px);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .nav-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover:not(:disabled) {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
        }

        .nav-btn.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #0056b3, #004085);
        }

        .results-container {
            display: none;
        }

        .results-title {
            font-size: 26px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e9ecef;
            border-left: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .supportive-message {
            background: linear-gradient(135deg, #e8f5e8, #f0fdf0);
            border: 2px solid #22c55e;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }

        .supportive-title {
            font-size: 24px;
            color: #16a34a;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .supportive-text {
            font-size: 18px;
            color: #15803d;
            line-height: 1.6;
            font-weight: 500;
        }

        .book-recommendations {
            margin-top: 25px;
        }
            background: ##FDFBD4;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
            text-align: left;
        }

        body.warm-background {
            background: linear-gradient(135deg, #fef7e7, #fff0d6, #fce7d6) !important;
        }

        .hypnotic-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: #222;
        }

        .circles {
            margin: 0 auto;
            width: 200px;
            height: 200px;
            border: 5px solid white;
            border-radius: 50%;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.8;
        }

        .one { animation: circles 2.4s infinite linear; }
        .two { animation: circles 2.4s infinite linear; animation-delay: 0.3s; }
        .three { animation: circles 2.4s infinite linear; animation-delay: 0.6s; }
        .four { animation: circles 2.4s infinite linear; animation-delay: 0.9s; }
        .five { animation: circles 2.4s infinite linear; animation-delay: 1.2s; }
        .six { animation: circles 2.4s infinite linear; animation-delay: 1.5s; }
        .seven { animation: circles 2.4s infinite linear; animation-delay: 1.8s; }
        .eight { animation: circles 2.4s infinite linear; animation-delay: 2.1s; }
        .nine { animation: circles 2.4s infinite linear; animation-delay: 2.4s; }

        @keyframes circles {
            from {
                transform: translate(-50%, -50%) scale(0.1);
                opacity: 0;
            }
            50% {
                opacity: 0.8;
            }
            to {
                transform: translate(-50%, -50%) scale(6);
                opacity: 0;
            }
        }

        .book-item {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .book-description {
            color: #666;
            line-height: 1.5;
        }

        .restart-btn {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            background: linear-gradient(135deg, #138496, #0f6674);
            transform: translateY(-1px);
        }

        .disclaimer {
            font-size: 14px;
            color: #888;
            margin-top: 20px;
            line-height: 1.4;
            font-style: italic;
        }

        @media (max-width: 600px) {
            .quiz-container {
                padding: 30px 20px;
            }
            
            .quiz-title {
                font-size: 24px;
            }
            
            .question {
                font-size: 18px;
            }
            
            .options {
                flex-direction: column;
                align-items: center;
            }
            
            .option-btn {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="hypnotic-background" id="hypnoticBackground">
        <div class="circles one"></div>
        <div class="circles two"></div>
        <div class="circles three"></div>
        <div class="circles four"></div>
        <div class="circles five"></div>
        <div class="circles six"></div>
        <div class="circles seven"></div>
        <div class="circles eight"></div>
        <div class="circles nine"></div>
    </div>
    
    <div class="quiz-container">
        <div class="quiz-section" id="quizSection">
            <div class="quiz-header">
                <h1 class="quiz-title">Personal Experience Assessment</h1>
                <p class="quiz-subtitle">This assessment will help us recommend supportive story books that may resonate with your experiences. Please answer honestly.</p>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="question-container">
                <p class="question" id="questionText"></p>
                <div class="options" id="optionsContainer"></div>
            </div>
            
            <div class="navigation">
                <button class="nav-btn" id="prevBtn" onclick="previousQuestion()" disabled>Previous</button>
                <span id="questionCounter">1 of 6</span>
                <button class="nav-btn primary" id="nextBtn" onclick="nextQuestion()" disabled>Next</button>
            </div>
            
            <div class="disclaimer">
                Your responses are confidential and will only be used to provide book recommendations. 
            </div>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <h2 class="results-title">Your Journey of Strength</h2>
            <div class="supportive-message" id="supportiveMessage" style="display: none;">
                <div class="supportive-title" id="supportiveTitle"></div>
                <div class="supportive-text" id="supportiveText"></div>
            </div>
            <div class="loading" id="loadingDiv">
                <div class="spinner"></div>
                <p>Finding the perfect books for you...</p>
            </div>
            <div class="book-recommendations" id="bookRecommendations"></div>
            <button class="restart-btn" onclick="restartQuiz()">Take Quiz Again</button>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyBcQCYLSj0Aug2xG7sr0WY8O4LGbPfHmJM"; // Replace with your actual API key
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";
        
        const questions = [
            {
                id: "bullying",
                text: "Have you ever experienced bullying (verbal, physical, or social exclusion) at school, work, or in social settings?",
                category: "bullying"
            },
            {
                id: "physical_abuse",
                text: "Have you ever experienced physical abuse or violence from family members, caregivers, or others?",
                category: "physical abuse"
            },
            {
                id: "emotional_abuse",
                text: "Have you ever experienced emotional or psychological abuse (constant criticism, threats, manipulation, or being made to feel worthless)?",
                category: "emotional abuse"
            },
            {
                id: "neglect",
                text: "Have you ever experienced neglect (lack of basic care, emotional support, or being left alone inappropriately)?",
                category: "neglect"
            },
            {
                id: "sexual_abuse",
                text: "Have you ever experienced any form of sexual abuse or inappropriate sexual contact?",
                category: "sexual abuse"
            },
            {
                id: "domestic_violence",
                text: "Have you ever witnessed or experienced domestic violence in your home or relationships?",
                category: "domestic violence"
            }
        ];

        let currentQuestion = 0;
        let answers = {};
        
        function createWarmBackground() {
            document.body.classList.add('warm-background');
            document.getElementById('hypnoticBackground').style.display = 'none';
        }

        function showHypnoticBackground() {
            document.body.classList.remove('warm-background');
            document.getElementById('hypnoticBackground').style.display = 'block';
        }
        
        function displayQuestion() {
            const question = questions[currentQuestion];
            document.getElementById('questionText').innerHTML = 
                `<span class="question-number">Question ${currentQuestion + 1}:</span><br>${question.text}`;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = `
                <button class="option-btn" onclick="selectAnswer('yes')">Yes</button>
                <button class="option-btn" onclick="selectAnswer('no')">No</button>
            `;
            
            // Restore previous answer if exists
            if (answers[question.id]) {
                const selectedBtn = optionsContainer.querySelector(`[onclick="selectAnswer('${answers[question.id]}')"]`);
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                    document.getElementById('nextBtn').disabled = false;
                }
            }
            
            // Update progress
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update counter
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1} of ${questions.length}`;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').textContent = currentQuestion === questions.length - 1 ? 'Get Recommendations' : 'Next';
        }
        
        function selectAnswer(answer) {
            const question = questions[currentQuestion];
            answers[question.id] = answer;
            
            // Update button styling
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Enable next button
            document.getElementById('nextBtn').disabled = false;
        }
        
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                displayQuestion();
                document.getElementById('nextBtn').disabled = true;
            } else {
                generateRecommendations();
            }
        }
        
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                displayQuestion();
            }
        }
        
        async function generateRecommendations() {
            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';
            
            // Switch to warm background
            createWarmBackground();
            
            const yesAnswers = [];
            for (const [questionId, answer] of Object.entries(answers)) {
                if (answer === 'yes') {
                    const question = questions.find(q => q.id === questionId);
                    yesAnswers.push(question.category);
                }
            }
            
            // Show supportive message
            showSupportiveMessage(yesAnswers);
            
            if (yesAnswers.length === 0) {
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('bookRecommendations').innerHTML = `
                    <div class="book-item">
                        <div class="book-title">General Self-Care and Resilience Books</div>
                        <div class="book-description">Since you haven't experienced these specific challenges, here are some wonderful books about building resilience, self-confidence, and emotional well-being that everyone can benefit from.</div>
                    </div>
                `;
                return;
            }
            
            try {
                const recommendations = [];
                
                for (const category of yesAnswers.slice(0, 3)) { // Limit to 3 requests
                    const prompt = `Suggest one specific story book title (fiction or memoir) that deals with healing and recovery from ${category}. Include the title, author, and a brief description of how it helps with healing. Focus on books that offer hope, resilience, and recovery rather than just depicting trauma.`;
                    
                    const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const bookText = data.candidates[0].content.parts[0].text;
                        recommendations.push({
                            category: category,
                            recommendation: bookText
                        });
                    }
                }
                
                document.getElementById('loadingDiv').style.display = 'none';
                
                if (recommendations.length > 0) {
                    let html = '<h3 style="color: #8b5a2b; margin-bottom: 20px; font-size: 22px; text-align: center;">Recommended Books for Your Healing Journey</h3>';
                    recommendations.forEach((rec, index) => {
                        html += `
                            <div class="book-item">
                                <div class="book-title">Recommendation ${index + 1}</div>
                                <div class="book-description">${rec.recommendation.replace(/\n/g, '<br>')}</div>
                            </div>
                        `;
                    });
                    document.getElementById('bookRecommendations').innerHTML = html;
                } else {
                    document.getElementById('bookRecommendations').innerHTML = `
                        <div class="book-item">
                            <div class="book-title">Unable to Load Recommendations</div>
                            <div class="book-description">We're sorry, but we couldn't load book recommendations at this time. Please try again later or consult with a librarian or counselor for personalized book suggestions.</div>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error generating recommendations:', error);
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('bookRecommendations').innerHTML = `
                    <div class="book-item">
                        <div class="book-title">Unable to Load Recommendations</div>
                        <div class="book-description">We're sorry, but we couldn't load book recommendations at this time. Please check your internet connection and try again.</div>
                    </div>
                `;
            }
        }
        
        function showSupportiveMessage(categories) {
            const supportiveMessages = {
                'bullying': {
                    title: 'You Are a Survivor and Warrior',
                    message: 'You have been a lone wolf from childhood, facing challenges that others may never understand. Your resilience and strength in overcoming bullying shows the incredible person you are today. You are worthy of love, respect, and kindness.'
                },
                'physical abuse': {
                    title: 'Your Strength is Remarkable',
                    message: 'You have endured physical pain that no one should ever face, yet here you are - strong, brave, and seeking healing. Your courage to survive and thrive is truly inspiring. You deserve safety, peace, and love.'
                },
                'emotional abuse': {
                    title: 'You Are Worthy and Valuable',
                    message: 'Despite being told otherwise, you are incredibly valuable and worthy of love. You have survived emotional storms that would break many others. Your heart still beats with hope, and that is beautiful.'
                },
                'neglect': {
                    title: 'You Are Enough, Always',
                    message: 'You learned to take care of yourself when others failed to do so. Your independence and self-reliance are remarkable qualities. You deserved care then, and you deserve all the love and support now.'
                },
                'sexual abuse': {
                    title: 'You Are Incredibly Strong',
                    message: 'You are really strong person and I am proud of where you are. What happened to you was never your fault. Your courage to continue living and seeking healing shows your incredible inner strength. You are a survivor.'
                },
                'domestic violence': {
                    title: 'You Chose Your Freedom',
                    message: 'You witnessed or experienced things no one should endure in what should have been a safe space. Your strength in recognizing this and seeking better for yourself is courageous. You deserve a life filled with peace and genuine love.'
                }
            };
            
            let message = '';
            let title = '';
            
            if (categories.length === 0) {
                title = 'You Are Taking Care of Yourself';
                message = 'It\'s wonderful that you\'re being proactive about your emotional well-being. Self-reflection and seeking supportive resources shows great wisdom and self-care.';
            } else {
                // Use the first category for the primary message
                const primaryCategory = categories[0];
                const supportiveMsg = supportiveMessages[primaryCategory];
                title = supportiveMsg.title;
                message = supportiveMsg.message;
                
                // If multiple categories, add an additional supportive note
                if (categories.length > 1) {
                    message += ' Your journey through multiple challenges has shaped you into an incredibly resilient person. You are stronger than you know.';
                }
            }
            
            document.getElementById('supportiveTitle').textContent = title;
            document.getElementById('supportiveText').textContent = message;
            document.getElementById('supportiveMessage').style.display = 'block';
        }
        
        function restartQuiz() {
            currentQuestion = 0;
            answers = {};
            document.getElementById('quizSection').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('loadingDiv').style.display = 'flex';
            document.getElementById('bookRecommendations').innerHTML = '';
            document.getElementById('supportiveMessage').style.display = 'none';
            
            // Restore hypnotic background
            showHypnoticBackground();
            
            displayQuestion();
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Initialize the application
        window.onload = function() {
            showHypnoticBackground();
            displayQuestion();
        };
    </script>
</body>
</html>
